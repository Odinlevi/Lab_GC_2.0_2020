<!DOCTYPE HTML>
<html>
<head>
    <title>3D</title>
    <link href="../Style/style.css" rel="stylesheet" type="text/css">
    <meta charset="UTF-8">
</head>
<body>
    <div class="block">
        <div class="left column">
            <div class="block create_objects">
                <div class="block_name">
                    <label>Add objects:</label>
                </div>
                <div class="block create standard">
                    <input value=" Create cube " type="button" class="create cube" onclick="CreateElement('cube')">
                    <input value=" Create cone " type="button" class="create cone" onclick="CreateElement('cone')">
                    <input value="Create sphere" type="button" class="create sphere" onclick="CreateElement('sphere')">
                </div>
                <div class="block create obj">
                    <label>Add .obj:</label>
                    <input id="inputObj" type="file" accept=".obj" oninput="CreateElement('obj')">
                </div>
                <input type="button" value="check" id="dovloeb" onclick="Main.CheckObjects()">
            </div>
            <hr>
            <div class="block objects_list">
                <div class="block_name">
                    <label>Objects list:</label>
                </div>
                <div class="block container">
                </div>
            </div>
            <hr>
            <div class="block object_manager">
                <div class="block_name">
                    <label>Object manager:</label>
                </div>
                <div class="subblock_name">
                    <label>Translation:</label>
                </div>
                <div class="block translation">
                    <input value="0" min="-100" max="100" type="range" class="object translation x range" oninput="ExternalTranslationObjectValue()">
                    <input value="0" min="-100" max="100" type="range" class="object translation y range" oninput="ExternalTranslationObjectValue()">
                    <input value="0" min="-100" max="100" type="range" class="object translation z range" oninput="ExternalTranslationObjectValue()">
                    <br>
                    <label>x:  </label><input value="0" type="text" class="object translation x text" size="1">
                    <label>y:  </label><input value="0" type="text" class="object translation y text" size="1">
                    <label>z:  </label><input value="0" type="text" class="object translation z text" size="1">
                </div>
                <div class="subblock_name">
                    <label>Rotation:</label>
                </div>
                <div class="block rotation">
                    <input value="0" min="-6.3" max="6.3" step="0.1" type="range" class="object rotation x range" oninput="ExternalRotationObjectValue()">
                    <input value="0" min="-6.3" max="6.3" step="0.1" type="range" class="object rotation y range" oninput="ExternalRotationObjectValue()">
                    <input value="0" min="-6.3" max="6.3" step="0.1" type="range" class="object rotation z range" oninput="ExternalRotationObjectValue()">
                    <br>
                    <label>x:  </label><input value="0" type="text" class="object rotation x text" size="1">
                    <label>y:  </label><input value="0" type="text" class="object rotation y text" size="1">
                    <label>z:  </label><input value="0" type="text" class="object rotation z text" size="1">
                </div>
                <div class="subblock_name">
                    <label>Scale:</label>
                </div>
                <div class="block scale">
                    <input value="1" min="0" max="15" step="0.1" type="range" class="object scale range" oninput="ExternalScaleObjectValue()">
                    <br>
                    <input value="1" type="text" class="object scale text" size="1">
                </div>
                <div class="subblock_name">
                    <label>Add texture:</label>
                </div>
                <div class="block add_texture">
                    <input id="inputTex" type="file" accept="image/png, .jpeg, .jpg, image/gif" oninput="SetTexture()">
                </div>
                <div class="block delete_object">
                    <input value="Delete object" type="button" class="delete_object" onclick="DeleteElement()">
                </div>
            </div>
            <hr>
            <div class="block camera">
                <div class="block_name">
                    <label>Camera:</label>
                </div>
                <div class="block rotation">
                    <input value="1" min="1" max="1000" step="1" type="range" class="camera zNear utility x range" oninput="UtilityCameraValue()">
                    <input value="2000" min="1" max="4000" step="1" type="range" class="camera zFar utility y range" oninput="UtilityCameraValue()">
                    <input value="60" min="1" max="180" step="1" type="range" class="camera FOV utility z range" oninput="UtilityCameraValue()">
                    <br>
                    <label>zNear:</label><input value="1" type="text" class="camera zNear utility x text" size="1">
                    <label>zFar:</label><input value="2000" type="text" class="camera zFar utility y text" size="1">
                    <label>FOV:</label><input value="60" type="text" class="camera FOV utility z text" size="1">
                </div>
                <div class="subblock_name">
                    <label>Translation:</label>
                </div>
                <div class="block translation">
                    <input value="0" min="-1000" max="1000" step="1" type="range" class="camera translation x range" oninput="TranslationCameraValue()">
                    <input value="0" min="-1000" max="1000" step="1" type="range" class="camera translation y range" oninput="TranslationCameraValue()">
                    <input value="100" min="-1000" max="1000" step="1" type="range" class="camera translation z range" oninput="TranslationCameraValue()">
                    <br>
                    <label>x:  </label><input value="0" type="text" class="camera translation x text" size="1">
                    <label>y:  </label><input value="0" type="text" class="camera translation y text" size="1">
                    <label>z:  </label><input value="100" type="text" class="camera translation z text" size="1">
                </div>
                <div class="subblock_name">
                    <label>Rotation:</label>
                </div>
                <div class="block rotation">
                    <input value="0" min="0" max="360" step="1" type="range" class="camera rotation x range" oninput="RotationCameraValue()">
                    <input value="0" min="0" max="360" step="1" type="range" class="camera rotation y range" oninput="RotationCameraValue()">
                    <input value="0" min="0" max="360" step="1" type="range" class="camera rotation z range" oninput="RotationCameraValue()">
                    <br>
                    <label>x:  </label><input value="0" type="text" class="camera rotation x text" size="1">
                    <label>y:  </label><input value="0" type="text" class="camera rotation y text" size="1">
                    <label>z:  </label><input value="0" type="text" class="camera rotation z text" size="1">
                </div>
            </div>
            <hr>
            <div class="block light_sources">
                <div class="block_name">
                    <label>Light sources:</label>
                </div>
                <div class="column light_source_1">
                    <div class="subblock_name">
                        <label>Light source 1:</label>
                        <div class="subblock_name">
                            <label>Translation:</label>
                        </div>
                        <div class="block translation">
                            <label>x:  </label><input value="-15" type="text" class="translation light_source_1 x text" size="1">
                            <input value="-15" min="-100" max="100" type="range" class="translation light_source_1 x range" oninput="TranslationLightSource1Value()">
                            <br>
                            <label>y:  </label><input value="0" type="text" class="translation light_source_1 y text" size="1">
                            <input value="0" min="-100" max="100" type="range" class="translation light_source_1 y range" oninput="TranslationLightSource1Value()">
                            <br>
                            <label>z:  </label><input value="0" type="text" class="translation light_source_1 z text" size="1">
                            <input value="0" min="-100" max="100" type="range" class="translation light_source_1 z range" oninput="TranslationLightSource1Value()">
                        </div>
                        <div class="subblock_name">
                            <label>Color:</label>
                        </div>
                        <div class="block color">
                            <label>R:  </label><input value="255" type="text" class="color light_source_1 x text" size="1">
                            <input value="255" min="0" max="255" type="range" class="color light_source_1 x range" oninput="ColorLightSource1Value()">
                            <br>
                            <label>G:  </label><input value="255" type="text" class="color light_source_1 y text" size="1">
                            <input value="255" min="0" max="255" type="range" class="color light_source_1 y range" oninput="ColorLightSource1Value()">
                            <br>
                            <label>B:  </label><input value="255" type="text" class="color light_source_1 z text" size="1">
                            <input value="255" min="0" max="255" type="range" class="color light_source_1 z range" oninput="ColorLightSource1Value()">
                        </div>
                        <div class="subblock_name">
                            <label>Shininess:</label>
                        </div>
                        <div class="block shininess">
                            <input value="10" min="0" max="100" step="0.1" type="range" class="shininess light_source_1 range" oninput="ShininessLightSource1ObjectValue()">
                            <br>
                            <input value="10" type="text" class="shininess light_source_1 text" size="1">
                        </div>
                    </div>
                </div>
                <div class="column light_source_2">
                    <div class="subblock_name">
                        <label>Light source 2:</label>
                        <div class="subblock_name">
                            <label>Translation:</label>
                        </div>
                        <div class="block translation">
                            <label>x:  </label><input value="15" type="text" class="translation light_source_2 x text" size="1">
                            <input value="15" min="-100" max="100" type="range" class="translation light_source_2 x range" oninput="TranslationLightSource2Value()">
                            <br>
                            <label>y:  </label><input value="0" type="text" class="translation light_source_2 y text" size="1">
                            <input value="0" min="-100" max="100" type="range" class="translation light_source_2 y range" oninput="TranslationLightSource2Value()">
                            <br>
                            <label>z:  </label><input value="0" type="text" class="translation light_source_2 z text" size="1">
                            <input value="0" min="-100" max="100" type="range" class="translation light_source_2 z range" oninput="TranslationLightSource2Value()">
                        </div>
                        <div class="subblock_name">
                            <label>Color:</label>
                        </div>
                        <div class="block color">
                            <label>R:  </label><input value="255" type="text" class="color light_source_2 x text" size="1">
                            <input value="255" min="0" max="255" type="range" class="color light_source_2 x range" oninput="ColorLightSource2Value()">
                            <br>
                            <label>G:  </label><input value="255" type="text" class="color light_source_2 y text" size="1">
                            <input value="255" min="0" max="255" type="range" class="color light_source_2 y range" oninput="ColorLightSource2Value()">
                            <br>
                            <label>B:  </label><input value="255" type="text" class="color light_source_2 z text" size="1">
                            <input value="255" min="0" max="255" type="range" class="color light_source_2 z range" oninput="ColorLightSource2Value()">
                        </div>
                        <div class="subblock_name">
                            <label>Shininess:</label>
                        </div>
                        <div class="block shininess">
                            <input value="10" min="0" max="100" step="0.1" type="range" class="shininess light_source_2 range" oninput="ShininessLightSource2ObjectValue()">
                            <br>
                            <input value="10" type="text" class="shininess light_source_2 text" size="1">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="right column">
            <canvas class="canvas"></canvas>
        </div>
    </div>

    <!-- vertex shader -->
    <script id="vertex-shader-3d" type="x-shader/x-vertex">
        attribute vec4 a_position;
    attribute vec4 a_color;
    attribute vec3 a_normal;
    attribute vec2 a_texcoord;

    uniform mat4 u_matrix;
    uniform mat4 u_world;
    uniform mat4 u_worldInverse;

    varying vec4 v_color;
    varying vec3 v_normal;
    varying vec4 v_position;

    varying vec3 v_vertex;

    varying vec2 v_texcoord;

    void main() {
        gl_Position = u_matrix * a_position;

        v_normal = mat3(u_worldInverse) * a_normal;
        v_vertex = (u_world * a_position).xyz;
        v_color = a_color;
        v_position = a_position;
        v_texcoord = a_texcoord;
    }
    </script>

    <!-- fragment shader -->
    <script id="fragment-shader-3d" type="x-shader/x-fragment">
            precision mediump float;

    uniform float u_lightMult;

    uniform vec3 u_firstLightPosition;
    uniform vec3 u_firstLightColor;
    uniform float u_firstLightShininess;
    uniform float u_firstLightAttenuation;

    uniform vec3 u_secondLightPosition;
    uniform vec3 u_secondLightColor;
    uniform float u_secondLightShininess;
    uniform float u_secondLightAttenuation;

    uniform vec3 u_ambientColor;

    uniform sampler2D u_texture;

    varying vec4 v_color;
    varying vec3 v_normal;
    varying vec3 v_vertex;
    varying vec2 v_texcoord;

    vec3 lightCalculation(vec3 normal,
                        vec3 position,
                        vec3 color,
                        float shininess,
                        float attenuation) {

        vec3 lightDirection = position - v_vertex;
        float lightDistance = length(lightDirection);
        lightDirection = normalize(lightDirection);

        float diffuseValue = dot(normal, lightDirection);
        diffuseValue = clamp(diffuseValue, 0.0, 1.0);

        vec3 diffuseColor = vec3(v_color) * diffuseValue * color;

        vec3 refl = 2.0 * dot(normal, lightDirection) * normal - lightDirection;
        refl = normalize(refl);

        vec3 cameraDirection = -1.0 * v_vertex;
        cameraDirection = normalize(cameraDirection);

        float specularValue = dot(refl, cameraDirection);
        specularValue = clamp(specularValue, 0.0, 1.0);
        specularValue = pow(specularValue, shininess);

        vec3 specularColor = color * specularValue;

        float att = 1.0 / (1.0 + attenuation * lightDistance);

        vec3 returnColor = att * (diffuseColor + specularColor);
        returnColor = clamp(returnColor, 0.0, 1.0);

        return returnColor;
    }

    void main() {
        vec3 ambientColor = u_ambientColor * vec3(v_color);

        vec3 normal = normalize(v_normal);

        vec3 firstColorLight = lightCalculation(normal,
        u_firstLightPosition,
        u_firstLightColor,
        u_firstLightShininess,
        u_firstLightAttenuation);

        vec3 secondColorLight = lightCalculation(normal,
        u_secondLightPosition,
        u_secondLightColor,
        u_secondLightShininess,
        u_secondLightAttenuation);

        vec3 light = ambientColor + firstColorLight + secondColorLight;
        light = mix(vec3(v_color), light, u_lightMult);
        vec4 color = vec4(light, v_color.a);

        gl_FragColor = texture2D(u_texture, v_texcoord) * color;
    }
    </script>

    <script src="../src/UI.js"></script>
    <script src="../src/object.js"></script>
    <script src="../src/camera.js"></script>
    <script src="../src/webgl-utils.js"></script>
    <script src="../src/m4.js"></script>
    <script src="../src/primitives.js"></script>
    <script src="../src/objInfo.js"></script>
    <script src="../src/v3.js"></script>
    <script src="../src/Main.js"></script>
</body>
</html>